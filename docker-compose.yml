services:
  entsoe-ote-data-uploader:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: entsoe-ote-data-uploader
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    volumes:
      # Mount app directory containing Python scripts (read-write for downloads)
      - ./app:/app/scripts
      # Mount alembic.ini for database migrations
      - ./alembic.ini:/app/alembic.ini:ro
      # Mount logs directory to access logs from host
      - ./logs:/var/log
      # Mount crontab file so it can be updated without rebuilding
      - ./crontab:/etc/cron.d/entsoe-ote-cron:ro
      # Mount certificates directory (create ./certs on host and place certificates there)
      - ./certs:/app/certs:ro
      # Mount browser profile directory to persist certificates in local storage
      - ./browser-profile:/app/browser-profile
      # Mount downloads directory for temporary file downloads
      - ./downloads:/app/downloads
      # Mount ote_files directory for final storage
      - ./ote_files:/app/ote_files
    environment:
      # Timezone for cron jobs
      - TZ=Europe/Prague
      # Python path to find common module
      - PYTHONPATH=/app/scripts
    env_file:
      - .env
    # extra_hosts only needed for local dev with Tailscale
    # Remove or comment out in production when DB is a Docker container
    extra_hosts:
      - "james:100.79.143.77"
